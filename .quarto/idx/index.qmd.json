{"title":"Final Project: [Sexual Education, Contraceptive Use, & Pregnancy Risk]","markdown":{"yaml":{"title":"Final Project: [Sexual Education, Contraceptive Use, & Pregnancy Risk]","author":"Belen Zemas & Amel Attalla","date":"2025-06-26","params":{"number":6,"purpose":"Final project for PUBH 6199: Visualizing Data with R"},"format":{"html":{"toc":true,"toc-location":"right","code-fold":true,"theme":"minty","self-contained":true}},"execute":{"echo":true,"warning":false,"message":false},"output-dir":"docs"},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n\n```{r}\n#| label: setup\n#| include: false\n\nknitr::opts_chunk$set(\n    warning = FALSE,\n    message = FALSE,\n    fig.path = \"figs/\",\n    fig.width = 7.252,\n    fig.height = 4,\n    comment = \"#>\",\n    fig.retina = 3\n)\n```\n\n\nIn this project we aim to examine the relationship between the types of sexual health education that are taught in the United States, contraceptive knowledge and risk of unplanned pregnancies, as well as how that knowledge is applied to real life. What constitutes appropriate and effective sexual education continues to be an increasingly debated topic, we aim to shed light on how different approaches-such as abstinence-only vs. contraceptive focused curricula may correlate with public health outcomes. For this project we have decided to create visualizations that focus on these three questions: \n\n1.⁠ ⁠How does sex education type influence perceptions of pregnancy risk?\n\n2.⁠ ⁠How does sex education type influence the method of contraceptive used?\n\n3.⁠ ⁠How do sexual education type, perceived pregnancy risk, and contraceptive method interrelate in shaping reproductive decision-making?\n\n\n## Data\n\nWe sourced our raw data set from the ICPSR website. Some of the key variables we are focusing on after cleaning the raw data are: birth control knowledge, risk of unplanned pregnancy, and types of sexual health education received. Cleaning the data set mainly consisted of narrowing down the variables from 340 to 12 keeping only the variables that we felt were relevant to our project. The steps taken to wrangle and clean the original data set can be seen in it's entirety in the code below.\n\n```{r}\n#| eval: false\n# Load libraries and data\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(haven)\n\nraw_data <- read_dta(\"data/Guttmacher 2009 Survey of contraceptive knowledge (Fog Zone).dta\")\n\nclean_fogzone <- raw_data %>% \n  select(gender,age4grps,race,riskr,abstonly,protect,curmethrr,pregknowr,totknowr,nummthdsr,wprotect,mprotect) %>% \n  rename(\n    Current_most_effective_method = curmethrr,\n    Pregnancy_knowledge = pregknowr,\n    BC_method_knowledge = totknowr,\n    BC_methods_heard_about = nummthdsr,\n    Age = age4grps,\n    Women_protection_status = wprotect,\n    Men_protection_status = mprotect,\n    Protection_status = protect\n  ) %>% \n  mutate(\n    gender = case_when(\n      gender == 1 ~ \"Female\",\n      gender == 2 ~ \"Male\",\n      TRUE ~ NA_character_\n    ),\n    race = case_when(\n      race == 1 ~ \"Hispanic\",\n      race == 2 ~ \"Non-Hispanic White\",\n      race == 3 ~ \"Non-hispanic Black\",\n      race == 4 ~ \"Asian\",\n      race == 5 ~ \"Other\",\n      TRUE ~ NA_character_\n    ),\n    Age = case_when(\n      Age == 1 ~ \"18-19\",\n      Age == 2 ~ \"20-21\",\n      Age == 3 ~ \"22-24\",\n      Age == 4 ~ \"25-29\",\n      TRUE ~ NA_character_\n    ),\n    riskr = case_when(\n      riskr == 1 ~ \"No\",\n      riskr == 2 ~ \"Yes\",\n      TRUE ~ NA_character_\n    ), \n    abstonly = case_when(\n      abstonly == 1 ~ \"Abstinence Only\",\n      abstonly == 2 ~ \"Abstinence Focused\",\n      abstonly == 3 ~ \"Contraceptive Focused\",\n      is.na(abstonly) ~ \"No sex ed/ don't know\",\n      TRUE ~ NA_character_\n    ), \n    Protection_status = case_when(\n      Protection_status == 1 ~ \"Well protected\",\n      Protection_status == 2 ~ \"Unprotected\",\n      Protection_status == 3 ~ \"Uncertain status\",\n      Protection_status == 7 ~ \"No Sex\",\n      TRUE ~ NA_character_\n    ),\n    Women_protection_status = case_when(\n      Women_protection_status == 1 ~ \"perfect pill use\",\n      Women_protection_status == 2 ~ \"perfect condom use\",\n      Women_protection_status == 3 ~ \"perfect depo use\",\n      Women_protection_status == 4 ~ \"long-acting method\",\n      Women_protection_status == 5 ~ \"skipped pills\",\n      Women_protection_status == 6 ~ \"missed condom use\",\n      Women_protection_status == 7 ~ \"depo late\",\n      Women_protection_status == 8 ~ \"other method\",\n      Women_protection_status == 9 ~ \"no method - likely at risk\",\n      Women_protection_status == 17 ~ \"no method - unkown risk\",\n      Women_protection_status == 19 ~ \"no sex ever/last 12 mo\",\n      TRUE ~ NA_character_\n    ),\n    Men_protection_status = case_when(\n      Men_protection_status == 1 ~ \"use horm/larc\",\n      Men_protection_status == 2 ~ \"perfect condom use\",\n      Men_protection_status == 3 ~ \"inconsistent condom use\",\n      Men_protection_status == 4 ~ \"withdrawl\",\n      Men_protection_status == 5 ~ \"other/unknown\",\n      Men_protection_status == 6 ~ \"no method - risk likely\",\n      Men_protection_status == 7 ~ \"no method - unknown risk\",\n      Men_protection_status == 8 ~ \"no sex ever/ last 12 mo\",\n      TRUE ~ NA_character_\n    ), \n    Current_most_effective_method = case_when(\n      Current_most_effective_method == 1 ~ \"long-acting alone\",\n      Current_most_effective_method == 2 ~ \"long-acting + condom\",\n      Current_most_effective_method == 3 ~ \"hormonal alone\",\n      Current_most_effective_method == 4 ~ \"hormonal + condoms\",\n      Current_most_effective_method == 5 ~ \"condoms\",\n      Current_most_effective_method == 6 ~ \"withdrawl/NFP\",\n      Current_most_effective_method == 7 ~ \"other/unknown\",\n      Current_most_effective_method == 17 ~ \"no method - risk unknown\",\n      Current_most_effective_method == 18 ~ \"no method - likely at risk\",\n      Current_most_effective_method == 19 ~ \"no sex ever/ last 12 mo\",\n      TRUE ~ NA_character_\n    ),\n    Pregnancy_knowledge = case_when(\n      Pregnancy_knowledge == 1 ~ \"0-3 correct\",\n      Pregnancy_knowledge == 4 ~ \"4 correct\",\n      Pregnancy_knowledge == 5 ~ \"5 correct\",\n      Pregnancy_knowledge == 6 ~ \"6 correct\",\n      TRUE ~ NA_character_\n    ),\n    BC_method_knowledge = case_when(\n      BC_method_knowledge == 1 ~ \"0-7 correct\",\n      BC_method_knowledge == 2 ~ \"8-11 correct\",\n      BC_method_knowledge == 3 ~ \"12-15 correct\",\n      BC_method_knowledge == 4 ~ \"16-18 correct\",\n      BC_method_knowledge == 5 ~ \"19+ correct\",\n      TRUE ~ NA_character_\n    ),\n    BC_methods_heard_about = case_when(\n      BC_methods_heard_about == 1 ~ \"0-6 methods\",\n      BC_methods_heard_about == 2 ~ \"7-10 methods\",\n      BC_methods_heard_about== 3 ~ \"11-13 methods\",\n      BC_methods_heard_about == 4 ~ \"14-16 methods\",\n      TRUE ~ NA_character_\n    )\n  )\n```   \n\n## Visualization 1: Sexual Health Education and Risk of Unintended Pregnancy (Stacked Bar Chart)\n\nThis plot displays the percentage of participants who perceive themselves to be at risk of unintended pregnancy, grouped by the type of sexual education they received. Across all sex ed types, the majority of participants report being at risk.Those who received no sex ed or don’t know report lower risk perception than those with abstinence-based education, suggesting that the type of education may shape perceived vulnerability. Something interesting to note is that abstinence-only group had the highest risk at 77.3%.\n\n```{r}\n# your code here\nlibrary(ggplot2)\nlibrary(viridis)\nlibrary(dplyr)\n\nclean_fogzone <- readRDS(\"data/clean_fogzone.rds\")\n\n\nclean_fogzone_factors <- clean_fogzone %>%\n  mutate(\n    abstonly = factor(\n      abstonly,\n      levels = c(\"No sex ed/ don't know\", \"Abstinence Only\", \"Abstinence Focused\", \"Contraceptive Focused\")\n    ),\n    riskr = factor(riskr, levels = c(\"No\", \"Yes\"))\n  )\n\npercent_data <- clean_fogzone_factors %>%\n  group_by(abstonly, riskr) %>%\n  summarise(n=n(), .groups=\"drop\") %>%\n  group_by(abstonly) %>%\n  mutate(pct = n / sum(n) * 100)\n\nggplot(percent_data, aes(x = abstonly, y = pct, fill = riskr)) +\n  geom_bar(stat = \"identity\", position = position_dodge(width = 0.9)) +\n  geom_text(\n    aes(label = paste0(round(pct, 1), \"%\")),\n    position = position_dodge(width = 0.9),\n    vjust = -0.4,\n    size = 3.5\n  ) +\n  scale_fill_viridis_d(\n    name = \"At Risk?\",\n    labels = c(\"No\", \"Yes\"),\n    option = \"D\"\n  ) +\n  labs(\n    title = \"Sexual Health Education and Risk of Unintended Pregnancy\",\n    x = \"Type of Sexual Health Education Recived\",\n    y = \"Percentage of Participants\"\n  ) +\n  ylim(0,100) + \n  theme_minimal(base_size = 12) +\n  theme(\n    plot.margin = margin(50, 30, 30, 30),  # Adjust all margins (top, right, bottom, left)\n    axis.text.x = element_text(angle = 20, hjust = 1, face = \"bold\", size = 10),\n    axis.text.y = element_text(face = \"bold\"),\n    plot.title = element_text(face = \"bold\"),\n    legend.position = \"top\"\n  )\n\n\n```\n\n## Visualization 2: Contraceptive Methods by Type of Sexual Education (Faceted Bar Chart)\n\nMore comprehensive sex ed (Contraceptive Focused) is associated with greater use of effective methods like condoms or hormonal contraception.No Method and No Sex (Last 12 Mo) appear across all education types, but tend to be more frequent in less comprehensive or absent education categories.\n\n```{r}\n# Step 1: Clean and relabel variables\ncontraceptive_data <- clean_fogzone_factors %>%\n  filter(!is.na(Current_most_effective_method)) %>%\n  mutate(\n    method_grouped = case_when(\n      Current_most_effective_method %in% c(\"no method - likely at risk\", \"no method - risk unknown\") ~ \"No method\",\n      Current_most_effective_method %in% c(\"withdrawl/NFP\", \"other/unknown\") ~ \"Other/Unknown/Withdrawal\",\n      TRUE ~ Current_most_effective_method\n    ),\n    # Capitalize for better display\n    method_grouped = recode(method_grouped,\n      \"condoms\" = \"Condoms\",\n      \"hormonal + condoms\" = \"Hormonal + Condoms\",\n      \"hormonal alone\" = \"Hormonal\",\n      \"long-acting + condom\" = \"LARC + Condoms\",\n      \"long-acting alone\" = \"LARC\",\n      \"No method\" = \"No Method\",\n      \"no sex ever/ last 12 mo\" = \"No Sex (Last 12 Mo)\",\n      \"Other/Unknown/Withdrawal\" = \"Other/Unknown/Withdrawal\"\n    ),\n    method_grouped = factor(method_grouped),\n    \n    # Add line breaks in abstonly for better facet titles\n    abstonly = recode(abstonly,\n      \"No sex ed/ don't know\" = \"No Sex Ed/\\nDon't know\",\n      \"Abstinence Only\" = \"Abstinence\\nOnly\",\n      \"Abstinence Focused\" = \"Abstinence\\nFocused\",\n      \"Contraceptive Focused\" = \"Contraceptive\\nFocused\"\n    )\n  )\n\n# Step 2: Create percentage summary\ncontraceptive_summary <- contraceptive_data %>%\n  group_by(abstonly, method_grouped) %>%\n  summarise(n = n(), .groups = \"drop\") %>%\n  group_by(abstonly) %>%\n  mutate(pct = n / sum(n) * 100)\n\n# Step 3: Plot with vertical bars and improved facet layout\nggplot(contraceptive_summary, aes(x = method_grouped, y = pct, fill = method_grouped)) +\n  geom_bar(stat = \"identity\") +\n  scale_fill_viridis_d(\n    name = \"Contraceptive Method\",\n    option = \"C\"\n  ) +\n  labs(\n    title = \"Contraceptive Methods by Type of Sexual Education\",\n    x = \"Contraceptive Method\",\n    y = \"Percentage of Participants\"\n  ) +\n  ylim(0, 40) +\n  facet_wrap(~abstonly, nrow = 1, scales = \"free_x\") +\n  theme_minimal(base_size = 14) +\n  theme(\n    plot.margin = margin(t = 60, r = 30, b = 30, l = 30),\n    axis.text.x = element_blank(),\n    axis.ticks.x = element_blank(),\n    axis.text.y = element_text(face = \"bold\"),\n    plot.title = element_text(face = \"bold\", hjust = 0.5, size = 12),\n    strip.text = element_text(face = \"bold\", size = 8),\n    legend.position = \"right\",\n    legend.title = element_text(face = \"bold\", size = 8),\n    legend.text = element_text(size = 8)\n  )\n\n\n```\n\n## Visualization 3: Flow of Sex Ed → Risk Perception → Contraceptive Method\n\nThis diagram shows the flow of participants through the type of sex ed they receive, whether they perceive pregnancy risk, and their chosen contraceptive method. Contraceptive-Focused more frequently flows into more effective methods such as condom use, hormonal, or both combined, where abstinence-only flows more into no method. \n\n\n\n```{r}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(ggalluvial)\nlibrary(dplyr)\n\nsankey_data <- contraceptive_data %>%\n  filter(!is.na(riskr), !is.na(abstonly), !is.na(method_grouped)) %>%\n  count(abstonly, riskr, method_grouped)  \n\nggplot(sankey_data,\n       aes(axis1 = abstonly, axis2 = riskr, axis3 = method_grouped,\n           y = n)) +\n  geom_alluvium(aes(fill = method_grouped), width = 0.3, alpha=0.8) +\n  geom_stratum(\n    width = 0.1,\n    fill = \"gray90\",\n    color = \"black\") +\n  geom_text(\n    stat = \"stratum\",\n    aes(label = after_stat(stratum)),\n    size = 3, \n    check_overlap =TRUE, \n    na.rm = TRUE,\n    label_axis3 = NULL\n  ) +\n  scale_x_discrete(limits = c(\"Sex Ed Type\", \"Perceived Risk\", \"Contraceptive Method\"),\n                   expand = c(0.05, 0.05)) +\n  scale_fill_viridis_d(option = \"C\", name = \"Contraceptive Method\") +\n  labs(\n    title = \"Flow from Sexual Education to Risk Perception to Contraceptive Behavior\",\n    y = \"Number of Participants\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0.5),\n    axis.text.y = element_blank(),\n    axis.ticks = element_blank(),\n    legend.title = element_text(size = 8, face = \"bold\"),\n    legend.text = element_text(size = 7),\n    legend.key.size = unit(0.4, \"cm\"),  \n    legend.spacing.y = unit(0.2, \"cm\"), \n    legend.position = \"right\",\n    plot.margin = margin(t = 20, r = 30, b = 20, l = 30)\n  )\n```\n\n## OR Shiny app: [Title Here]\n\n_If you choose to create a Shiny app, describe the app's purpose and functionality. Save your code inside the shiny-app/ folder, replace the URL below with your app's URL_\n\n[Click here to open the interactive Shiny app](https://cindyhu.shinyapps.io/two-files-app/)\n\n## Interpretation\n\n_Summarize your key findings. What do your visualizations reveal?_\n\n## Limitations\n\n_Discuss any data quality or design limitations._\n\n## Conclusion\n\n_Wrap up your project with a takeaway message or next steps._\n\n## References\n\n_Include any references to data sources, packages, or literature you used. If your visualization design is inspired by someone else's work, cite those too._\n\n1. Reference 1\n2. Reference 2\n3. Reference 3\n\n","srcMarkdownNoYaml":"\n\n\n```{r}\n#| label: setup\n#| include: false\n\nknitr::opts_chunk$set(\n    warning = FALSE,\n    message = FALSE,\n    fig.path = \"figs/\",\n    fig.width = 7.252,\n    fig.height = 4,\n    comment = \"#>\",\n    fig.retina = 3\n)\n```\n\n## Introduction\n\nIn this project we aim to examine the relationship between the types of sexual health education that are taught in the United States, contraceptive knowledge and risk of unplanned pregnancies, as well as how that knowledge is applied to real life. What constitutes appropriate and effective sexual education continues to be an increasingly debated topic, we aim to shed light on how different approaches-such as abstinence-only vs. contraceptive focused curricula may correlate with public health outcomes. For this project we have decided to create visualizations that focus on these three questions: \n\n1.⁠ ⁠How does sex education type influence perceptions of pregnancy risk?\n\n2.⁠ ⁠How does sex education type influence the method of contraceptive used?\n\n3.⁠ ⁠How do sexual education type, perceived pregnancy risk, and contraceptive method interrelate in shaping reproductive decision-making?\n\n\n## Data\n\nWe sourced our raw data set from the ICPSR website. Some of the key variables we are focusing on after cleaning the raw data are: birth control knowledge, risk of unplanned pregnancy, and types of sexual health education received. Cleaning the data set mainly consisted of narrowing down the variables from 340 to 12 keeping only the variables that we felt were relevant to our project. The steps taken to wrangle and clean the original data set can be seen in it's entirety in the code below.\n\n```{r}\n#| eval: false\n# Load libraries and data\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(haven)\n\nraw_data <- read_dta(\"data/Guttmacher 2009 Survey of contraceptive knowledge (Fog Zone).dta\")\n\nclean_fogzone <- raw_data %>% \n  select(gender,age4grps,race,riskr,abstonly,protect,curmethrr,pregknowr,totknowr,nummthdsr,wprotect,mprotect) %>% \n  rename(\n    Current_most_effective_method = curmethrr,\n    Pregnancy_knowledge = pregknowr,\n    BC_method_knowledge = totknowr,\n    BC_methods_heard_about = nummthdsr,\n    Age = age4grps,\n    Women_protection_status = wprotect,\n    Men_protection_status = mprotect,\n    Protection_status = protect\n  ) %>% \n  mutate(\n    gender = case_when(\n      gender == 1 ~ \"Female\",\n      gender == 2 ~ \"Male\",\n      TRUE ~ NA_character_\n    ),\n    race = case_when(\n      race == 1 ~ \"Hispanic\",\n      race == 2 ~ \"Non-Hispanic White\",\n      race == 3 ~ \"Non-hispanic Black\",\n      race == 4 ~ \"Asian\",\n      race == 5 ~ \"Other\",\n      TRUE ~ NA_character_\n    ),\n    Age = case_when(\n      Age == 1 ~ \"18-19\",\n      Age == 2 ~ \"20-21\",\n      Age == 3 ~ \"22-24\",\n      Age == 4 ~ \"25-29\",\n      TRUE ~ NA_character_\n    ),\n    riskr = case_when(\n      riskr == 1 ~ \"No\",\n      riskr == 2 ~ \"Yes\",\n      TRUE ~ NA_character_\n    ), \n    abstonly = case_when(\n      abstonly == 1 ~ \"Abstinence Only\",\n      abstonly == 2 ~ \"Abstinence Focused\",\n      abstonly == 3 ~ \"Contraceptive Focused\",\n      is.na(abstonly) ~ \"No sex ed/ don't know\",\n      TRUE ~ NA_character_\n    ), \n    Protection_status = case_when(\n      Protection_status == 1 ~ \"Well protected\",\n      Protection_status == 2 ~ \"Unprotected\",\n      Protection_status == 3 ~ \"Uncertain status\",\n      Protection_status == 7 ~ \"No Sex\",\n      TRUE ~ NA_character_\n    ),\n    Women_protection_status = case_when(\n      Women_protection_status == 1 ~ \"perfect pill use\",\n      Women_protection_status == 2 ~ \"perfect condom use\",\n      Women_protection_status == 3 ~ \"perfect depo use\",\n      Women_protection_status == 4 ~ \"long-acting method\",\n      Women_protection_status == 5 ~ \"skipped pills\",\n      Women_protection_status == 6 ~ \"missed condom use\",\n      Women_protection_status == 7 ~ \"depo late\",\n      Women_protection_status == 8 ~ \"other method\",\n      Women_protection_status == 9 ~ \"no method - likely at risk\",\n      Women_protection_status == 17 ~ \"no method - unkown risk\",\n      Women_protection_status == 19 ~ \"no sex ever/last 12 mo\",\n      TRUE ~ NA_character_\n    ),\n    Men_protection_status = case_when(\n      Men_protection_status == 1 ~ \"use horm/larc\",\n      Men_protection_status == 2 ~ \"perfect condom use\",\n      Men_protection_status == 3 ~ \"inconsistent condom use\",\n      Men_protection_status == 4 ~ \"withdrawl\",\n      Men_protection_status == 5 ~ \"other/unknown\",\n      Men_protection_status == 6 ~ \"no method - risk likely\",\n      Men_protection_status == 7 ~ \"no method - unknown risk\",\n      Men_protection_status == 8 ~ \"no sex ever/ last 12 mo\",\n      TRUE ~ NA_character_\n    ), \n    Current_most_effective_method = case_when(\n      Current_most_effective_method == 1 ~ \"long-acting alone\",\n      Current_most_effective_method == 2 ~ \"long-acting + condom\",\n      Current_most_effective_method == 3 ~ \"hormonal alone\",\n      Current_most_effective_method == 4 ~ \"hormonal + condoms\",\n      Current_most_effective_method == 5 ~ \"condoms\",\n      Current_most_effective_method == 6 ~ \"withdrawl/NFP\",\n      Current_most_effective_method == 7 ~ \"other/unknown\",\n      Current_most_effective_method == 17 ~ \"no method - risk unknown\",\n      Current_most_effective_method == 18 ~ \"no method - likely at risk\",\n      Current_most_effective_method == 19 ~ \"no sex ever/ last 12 mo\",\n      TRUE ~ NA_character_\n    ),\n    Pregnancy_knowledge = case_when(\n      Pregnancy_knowledge == 1 ~ \"0-3 correct\",\n      Pregnancy_knowledge == 4 ~ \"4 correct\",\n      Pregnancy_knowledge == 5 ~ \"5 correct\",\n      Pregnancy_knowledge == 6 ~ \"6 correct\",\n      TRUE ~ NA_character_\n    ),\n    BC_method_knowledge = case_when(\n      BC_method_knowledge == 1 ~ \"0-7 correct\",\n      BC_method_knowledge == 2 ~ \"8-11 correct\",\n      BC_method_knowledge == 3 ~ \"12-15 correct\",\n      BC_method_knowledge == 4 ~ \"16-18 correct\",\n      BC_method_knowledge == 5 ~ \"19+ correct\",\n      TRUE ~ NA_character_\n    ),\n    BC_methods_heard_about = case_when(\n      BC_methods_heard_about == 1 ~ \"0-6 methods\",\n      BC_methods_heard_about == 2 ~ \"7-10 methods\",\n      BC_methods_heard_about== 3 ~ \"11-13 methods\",\n      BC_methods_heard_about == 4 ~ \"14-16 methods\",\n      TRUE ~ NA_character_\n    )\n  )\n```   \n\n## Visualization 1: Sexual Health Education and Risk of Unintended Pregnancy (Stacked Bar Chart)\n\nThis plot displays the percentage of participants who perceive themselves to be at risk of unintended pregnancy, grouped by the type of sexual education they received. Across all sex ed types, the majority of participants report being at risk.Those who received no sex ed or don’t know report lower risk perception than those with abstinence-based education, suggesting that the type of education may shape perceived vulnerability. Something interesting to note is that abstinence-only group had the highest risk at 77.3%.\n\n```{r}\n# your code here\nlibrary(ggplot2)\nlibrary(viridis)\nlibrary(dplyr)\n\nclean_fogzone <- readRDS(\"data/clean_fogzone.rds\")\n\n\nclean_fogzone_factors <- clean_fogzone %>%\n  mutate(\n    abstonly = factor(\n      abstonly,\n      levels = c(\"No sex ed/ don't know\", \"Abstinence Only\", \"Abstinence Focused\", \"Contraceptive Focused\")\n    ),\n    riskr = factor(riskr, levels = c(\"No\", \"Yes\"))\n  )\n\npercent_data <- clean_fogzone_factors %>%\n  group_by(abstonly, riskr) %>%\n  summarise(n=n(), .groups=\"drop\") %>%\n  group_by(abstonly) %>%\n  mutate(pct = n / sum(n) * 100)\n\nggplot(percent_data, aes(x = abstonly, y = pct, fill = riskr)) +\n  geom_bar(stat = \"identity\", position = position_dodge(width = 0.9)) +\n  geom_text(\n    aes(label = paste0(round(pct, 1), \"%\")),\n    position = position_dodge(width = 0.9),\n    vjust = -0.4,\n    size = 3.5\n  ) +\n  scale_fill_viridis_d(\n    name = \"At Risk?\",\n    labels = c(\"No\", \"Yes\"),\n    option = \"D\"\n  ) +\n  labs(\n    title = \"Sexual Health Education and Risk of Unintended Pregnancy\",\n    x = \"Type of Sexual Health Education Recived\",\n    y = \"Percentage of Participants\"\n  ) +\n  ylim(0,100) + \n  theme_minimal(base_size = 12) +\n  theme(\n    plot.margin = margin(50, 30, 30, 30),  # Adjust all margins (top, right, bottom, left)\n    axis.text.x = element_text(angle = 20, hjust = 1, face = \"bold\", size = 10),\n    axis.text.y = element_text(face = \"bold\"),\n    plot.title = element_text(face = \"bold\"),\n    legend.position = \"top\"\n  )\n\n\n```\n\n## Visualization 2: Contraceptive Methods by Type of Sexual Education (Faceted Bar Chart)\n\nMore comprehensive sex ed (Contraceptive Focused) is associated with greater use of effective methods like condoms or hormonal contraception.No Method and No Sex (Last 12 Mo) appear across all education types, but tend to be more frequent in less comprehensive or absent education categories.\n\n```{r}\n# Step 1: Clean and relabel variables\ncontraceptive_data <- clean_fogzone_factors %>%\n  filter(!is.na(Current_most_effective_method)) %>%\n  mutate(\n    method_grouped = case_when(\n      Current_most_effective_method %in% c(\"no method - likely at risk\", \"no method - risk unknown\") ~ \"No method\",\n      Current_most_effective_method %in% c(\"withdrawl/NFP\", \"other/unknown\") ~ \"Other/Unknown/Withdrawal\",\n      TRUE ~ Current_most_effective_method\n    ),\n    # Capitalize for better display\n    method_grouped = recode(method_grouped,\n      \"condoms\" = \"Condoms\",\n      \"hormonal + condoms\" = \"Hormonal + Condoms\",\n      \"hormonal alone\" = \"Hormonal\",\n      \"long-acting + condom\" = \"LARC + Condoms\",\n      \"long-acting alone\" = \"LARC\",\n      \"No method\" = \"No Method\",\n      \"no sex ever/ last 12 mo\" = \"No Sex (Last 12 Mo)\",\n      \"Other/Unknown/Withdrawal\" = \"Other/Unknown/Withdrawal\"\n    ),\n    method_grouped = factor(method_grouped),\n    \n    # Add line breaks in abstonly for better facet titles\n    abstonly = recode(abstonly,\n      \"No sex ed/ don't know\" = \"No Sex Ed/\\nDon't know\",\n      \"Abstinence Only\" = \"Abstinence\\nOnly\",\n      \"Abstinence Focused\" = \"Abstinence\\nFocused\",\n      \"Contraceptive Focused\" = \"Contraceptive\\nFocused\"\n    )\n  )\n\n# Step 2: Create percentage summary\ncontraceptive_summary <- contraceptive_data %>%\n  group_by(abstonly, method_grouped) %>%\n  summarise(n = n(), .groups = \"drop\") %>%\n  group_by(abstonly) %>%\n  mutate(pct = n / sum(n) * 100)\n\n# Step 3: Plot with vertical bars and improved facet layout\nggplot(contraceptive_summary, aes(x = method_grouped, y = pct, fill = method_grouped)) +\n  geom_bar(stat = \"identity\") +\n  scale_fill_viridis_d(\n    name = \"Contraceptive Method\",\n    option = \"C\"\n  ) +\n  labs(\n    title = \"Contraceptive Methods by Type of Sexual Education\",\n    x = \"Contraceptive Method\",\n    y = \"Percentage of Participants\"\n  ) +\n  ylim(0, 40) +\n  facet_wrap(~abstonly, nrow = 1, scales = \"free_x\") +\n  theme_minimal(base_size = 14) +\n  theme(\n    plot.margin = margin(t = 60, r = 30, b = 30, l = 30),\n    axis.text.x = element_blank(),\n    axis.ticks.x = element_blank(),\n    axis.text.y = element_text(face = \"bold\"),\n    plot.title = element_text(face = \"bold\", hjust = 0.5, size = 12),\n    strip.text = element_text(face = \"bold\", size = 8),\n    legend.position = \"right\",\n    legend.title = element_text(face = \"bold\", size = 8),\n    legend.text = element_text(size = 8)\n  )\n\n\n```\n\n## Visualization 3: Flow of Sex Ed → Risk Perception → Contraceptive Method\n\nThis diagram shows the flow of participants through the type of sex ed they receive, whether they perceive pregnancy risk, and their chosen contraceptive method. Contraceptive-Focused more frequently flows into more effective methods such as condom use, hormonal, or both combined, where abstinence-only flows more into no method. \n\n\n\n```{r}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(ggalluvial)\nlibrary(dplyr)\n\nsankey_data <- contraceptive_data %>%\n  filter(!is.na(riskr), !is.na(abstonly), !is.na(method_grouped)) %>%\n  count(abstonly, riskr, method_grouped)  \n\nggplot(sankey_data,\n       aes(axis1 = abstonly, axis2 = riskr, axis3 = method_grouped,\n           y = n)) +\n  geom_alluvium(aes(fill = method_grouped), width = 0.3, alpha=0.8) +\n  geom_stratum(\n    width = 0.1,\n    fill = \"gray90\",\n    color = \"black\") +\n  geom_text(\n    stat = \"stratum\",\n    aes(label = after_stat(stratum)),\n    size = 3, \n    check_overlap =TRUE, \n    na.rm = TRUE,\n    label_axis3 = NULL\n  ) +\n  scale_x_discrete(limits = c(\"Sex Ed Type\", \"Perceived Risk\", \"Contraceptive Method\"),\n                   expand = c(0.05, 0.05)) +\n  scale_fill_viridis_d(option = \"C\", name = \"Contraceptive Method\") +\n  labs(\n    title = \"Flow from Sexual Education to Risk Perception to Contraceptive Behavior\",\n    y = \"Number of Participants\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0.5),\n    axis.text.y = element_blank(),\n    axis.ticks = element_blank(),\n    legend.title = element_text(size = 8, face = \"bold\"),\n    legend.text = element_text(size = 7),\n    legend.key.size = unit(0.4, \"cm\"),  \n    legend.spacing.y = unit(0.2, \"cm\"), \n    legend.position = \"right\",\n    plot.margin = margin(t = 20, r = 30, b = 20, l = 30)\n  )\n```\n\n## OR Shiny app: [Title Here]\n\n_If you choose to create a Shiny app, describe the app's purpose and functionality. Save your code inside the shiny-app/ folder, replace the URL below with your app's URL_\n\n[Click here to open the interactive Shiny app](https://cindyhu.shinyapps.io/two-files-app/)\n\n## Interpretation\n\n_Summarize your key findings. What do your visualizations reveal?_\n\n## Limitations\n\n_Discuss any data quality or design limitations._\n\n## Conclusion\n\n_Wrap up your project with a takeaway message or next steps._\n\n## References\n\n_Include any references to data sources, packages, or literature you used. If your visualization design is inspired by someone else's work, cite those too._\n\n1. Reference 1\n2. Reference 2\n3. Reference 3\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"self-contained":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.31","title":"Final Project: [Sexual Education, Contraceptive Use, & Pregnancy Risk]","author":"Belen Zemas & Amel Attalla","date":"2025-06-26","params":{"number":6,"purpose":"Final project for PUBH 6199: Visualizing Data with R"},"output-dir":"docs","toc-location":"right","theme":"minty"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}